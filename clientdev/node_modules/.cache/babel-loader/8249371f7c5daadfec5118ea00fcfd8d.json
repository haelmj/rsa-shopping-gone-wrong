{"ast":null,"code":"import _toConsumableArray from\"/Users/haelmj/Documents/Security/ctf-challenges/rsa/bookcase-vuln/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/haelmj/Documents/Security/ctf-challenges/rsa/bookcase-vuln/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/haelmj/Documents/Security/ctf-challenges/rsa/bookcase-vuln/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/haelmj/Documents/Security/ctf-challenges/rsa/bookcase-vuln/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,Fragment}from\"react\";import{BrowserRouter as Router,Route}from\"react-router-dom\";import\"./styles/App.css\";import Header from\"./components/Header\";import Search from\"./components/Search\";import BookList from\"./components/BookList\";import About from\"./pages/About\";import data from\"./models/local-books.json\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var App=function App(){var _useState=useState(data),_useState2=_slicedToArray(_useState,2),books=_useState2[0],setBooks=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),bookcase=_useState4[0],setBookcase=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),keyword=_useState6[0],setKeyword=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),price=_useState8[0],setPrice=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),message=_useState10[0],setMessage=_useState10[1];function findBooks(_x){return _findBooks.apply(this,arguments);}function _findBooks(){_findBooks=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(value){var url,results;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:url=\"https://www.googleapis.com/books/v1/volumes?q=\".concat(value,\"&filter=paid-ebooks&print-type=books&projection=lite\");_context2.next=3;return fetch(url).then(function(res){return res.json();});case 3:results=_context2.sent;if(!results.error){setBooks(results.items);}case 5:case\"end\":return _context2.stop();}}},_callee2);}));return _findBooks.apply(this,arguments);}var handleCheckout=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log('called');_context.next=3;return fetch('/checkout',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({\"price\":price,\"books\":bookcase.volumeInfo.title})}).then(function(res){return res.text();});case 3:result=_context.sent;setMessage(result);case 5:case\"end\":return _context.stop();}}},_callee);}));return function handleCheckout(){return _ref.apply(this,arguments);};}();var calculateBookcase=function calculateBookcase(){var amount=0;bookcase.forEach(function(book){book.saleInfo.retailPrice?amount+=book.saleInfo.retailPrice.amount:amount+=0;});setPrice(amount);};var addToBookcase=function addToBookcase(id){setBookcase(bookcase.concat(books.filter(function(book){return book.id===id;})));setBooks(_toConsumableArray(books.map(function(book){if(book.id===id){book.read=true;}return book;})));};var removeFromBookcase=function removeFromBookcase(id){setBookcase(bookcase.filter(function(book){return book.id!==id;}));setBooks(_toConsumableArray(books.map(function(book){if(book.id===id){book.read=false;}return book;})));};useEffect(function(){document.title=\"My Library \".concat(bookcase.length,\" Read\");Array.from(document.getElementsByClassName(\"bookLink\")).forEach(function(el){el.innerText=\" Bookcase (\".concat(bookcase.length,\")\");});});return/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",render:function render(){return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(Header,{bookLength:bookcase.length}),/*#__PURE__*/_jsx(Search,{findBooks:findBooks,keyword:keyword,setKeyword:setKeyword}),/*#__PURE__*/_jsx(BookList,{books:books,stored:\"library\",addToBookcase:addToBookcase,removeFromBookcase:removeFromBookcase})]});}}),/*#__PURE__*/_jsx(Route,{path:\"/bookcase\",render:function render(){return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(Header,{bookLength:bookcase.length,price:price}),/*#__PURE__*/_jsx(Search,{findBooks:findBooks,keyword:keyword,setKeyword:setKeyword}),/*#__PURE__*/_jsx(BookList,{price:price,books:bookcase,handleCheckout:handleCheckout,stored:\"bookcase\",addToBookcase:addToBookcase,removeFromBookcase:removeFromBookcase,calculateBookcase:calculateBookcase})]});}}),/*#__PURE__*/_jsx(Route,{path:\"/about\",component:function component(){return/*#__PURE__*/_jsx(About,{bookcaseLength:bookcase.length});}})]})});};export default App;","map":{"version":3,"sources":["/Users/haelmj/Documents/Security/ctf-challenges/rsa/bookcase-vuln/src/App.js"],"names":["React","useState","useEffect","Fragment","BrowserRouter","Router","Route","Header","Search","BookList","About","data","App","books","setBooks","bookcase","setBookcase","keyword","setKeyword","price","setPrice","message","setMessage","findBooks","value","url","fetch","then","res","json","results","error","items","handleCheckout","console","log","method","headers","body","JSON","stringify","volumeInfo","title","text","result","calculateBookcase","amount","forEach","book","saleInfo","retailPrice","addToBookcase","id","concat","filter","map","read","removeFromBookcase","document","length","Array","from","getElementsByClassName","el","innerText"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, Fragment } from \"react\";\nimport { BrowserRouter as Router, Route } from \"react-router-dom\";\nimport \"./styles/App.css\";\nimport Header from \"./components/Header\";\nimport Search from \"./components/Search\";\nimport BookList from \"./components/BookList\";\nimport About from \"./pages/About\";\nimport data from \"./models/local-books.json\";\n\nconst App = () => {\n  const [books, setBooks] = useState(data);\n  const [bookcase, setBookcase] = useState([]);\n  const [keyword, setKeyword] = useState(\"\");\n  const [price, setPrice] = useState(0);\n  const [message, setMessage] = useState(\"\");\n\n  async function findBooks(value) {\n    const url = `https://www.googleapis.com/books/v1/volumes?q=${value}&filter=paid-ebooks&print-type=books&projection=lite`;\n    const results = await fetch(url).then((res) => res.json());\n    if (!results.error) {\n      setBooks(results.items);\n    }\n  }\n\n  const handleCheckout = async () => {\n    console.log('called')\n    const result = await fetch('/checkout', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        \"price\": price,\n        \"books\": bookcase.volumeInfo.title\n      })\n    }).then((res) => res.text());\n    setMessage(result);\n  }\n\n  const calculateBookcase = () => {\n    let amount = 0;\n    bookcase.forEach((book)=>{\n      book.saleInfo.retailPrice ? amount += book.saleInfo.retailPrice.amount : amount += 0;\n    })\n    setPrice(amount);\n  }\n\n  const addToBookcase = (id) => {\n    setBookcase(bookcase.concat(books.filter((book) => book.id === id)));\n    setBooks([\n      ...books.map((book) => {\n        if (book.id === id) {\n          book.read = true;\n        }\n        return book;\n      }),\n    ]);\n  };\n\n  const removeFromBookcase = (id) => {\n    setBookcase(bookcase.filter((book) => book.id !== id));\n    setBooks([\n      ...books.map((book) => {\n        if (book.id === id) {\n          book.read = false;\n        }\n        return book;\n      }),\n    ]);\n  };\n\n  useEffect(() => {\n    document.title = `My Library ${bookcase.length} Read`;\n    Array.from(document.getElementsByClassName(\"bookLink\")).forEach((el) => {\n      el.innerText = ` Bookcase (${bookcase.length})`;\n    });\n  });\n\n  return (\n    <Router>\n      <div className=\"container\">\n        <Route\n          exact\n          path=\"/\"\n          render={() => (\n            <Fragment>\n              <Header bookLength={bookcase.length} />\n              <Search\n                findBooks={findBooks}\n                keyword={keyword}\n                setKeyword={setKeyword}\n              />\n\n              <BookList\n                books={books}\n                stored=\"library\"\n                addToBookcase={addToBookcase}\n                removeFromBookcase={removeFromBookcase}\n              />\n            </Fragment>\n          )}\n        />\n        <Route\n          path=\"/bookcase\"\n          render={() => (\n            <Fragment>\n              <Header bookLength={bookcase.length} price={price}/>\n              <Search\n                findBooks={findBooks}\n                keyword={keyword}\n                setKeyword={setKeyword}\n              />\n              <BookList\n                price={price}\n                books={bookcase}\n                handleCheckout={handleCheckout}\n                stored=\"bookcase\"\n                addToBookcase={addToBookcase}\n                removeFromBookcase={removeFromBookcase}\n                calculateBookcase={calculateBookcase}\n              />\n            </Fragment>\n          )}\n        />\n        <Route\n          path=\"/about\"\n          component={() => <About bookcaseLength={bookcase.length} />}\n        />\n      </div>\n    </Router>\n  );\n};\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}